<!-- <!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<style>
table {
  border-collapse: collapse;
  width: 100%;
}

th, td {
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #D6EEEE;
}
</style>
</head>
<body>


<table id='majid'>
</table>
<script type="text/javascript">
	function reload(){
	  var xhr = new XMLHttpRequest();
	  xhr.open("POST", '/api/', true);
	  xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
	  xhr.onreadystatechange = function () {
	  if (xhr.readyState === 4 && xhr.status === 200) {
	      var arr = JSON.parse(xhr.responseText);
	      	$('#majid').empty()
	      	$('#majid').append(
	      			`
	      				<tr>
	  <th>location_x</th>
	  <th>location_y</th>
	  <th>SPO2</th>
	  <th>BPM</th>
	  </tr>
	      			`
	      		);
	      for (let i = 0; i < arr.health_history.length; i++) {
	      	$('#majid').append(
				`
						<tr>
							  <th>${arr.health_history[i].location_x}</th>
							  <th>${arr.health_history[i].location_y}</th>
							  <th>${arr.health_history[i].SPO2}</th>
							  <th>${arr.health_history[i].BPM}</th>z
						</tr>
				`
	      		)
        	}
	      console.log(1);
	    }
	  };

	  xhr.send(
	  	);
	}
	reload();

	setInterval(reload, 0.1)
</script>
</body>
</html> -->




<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Chart</title>
    <!-- Include Chart.js library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>

<body>

    <!-- Create a canvas element for the chart -->
    <canvas id="lineChart" width="400" height="200"></canvas>

    <script type="text/javascript">

        var time = [];
        var sop2 = [];
        var myChart; // Move myChart outside the reload function

        async function reload() {

            var xhr = new XMLHttpRequest();
            xhr.open("POST", '/api/', true);

            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

            xhr.onreadystatechange = await function () {

                if (xhr.readyState === 4 && xhr.status === 200) {

                    var arr = JSON.parse(xhr.responseText);

                    // Clear the existing data arrays
                    time = [];
                    sop2 = [];

                    for (let i = 0; i < arr.health_history.length; i++) {
                        sop2.push(arr.health_history[i].SPO2);
                        time.push(arr.health_history[i].time);
                    }

                    // Destroy the existing chart
                    if (myChart instanceof Chart) {
                        myChart.destroy();
                    }

                    // Create a new chart
                    var ctx = document.getElementById('lineChart').getContext('2d');
                    myChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: time,
                            datasets: [{
                                label: 'spo2-time',
                                data: sop2,
                                borderColor: 'blue',
                                borderWidth: 2,
                                fill: false
                            }]
                        },
                        options: {
                            scales: {
                                x: {
                                    type: 'category', // Specify that the x-axis should be treated as a category axis
                                    position: 'bottom'
                                },
                                y: {
                                    beginAtZero: true
                                }
                            }
                        }
                    });
                }
            }

            xhr.send();
        }

        reload();
        setInterval(reload, 10000);

    </script>

</body>

</html>
